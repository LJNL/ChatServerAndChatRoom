
# 聊天室程序

聊天平台+多聊天室。

## 功能

* 聊天群发。
* 可以建立，加入，退出不同房间。
* 进入房间后的功能：开关门，改名等，其中开关门功能，只有聊天室建立者有权力。
* 容错能力：断线重连，如果TCP连接未断仅仅是断网，网络恢复后，自动回到之前的房间。若TCP连接断掉，即受到SIGPIPE信号，则输入"RETRY"重新建立连接后，自动恢复到之前的房间。

## 实现原理

* 使用epoll作为socket管理机制。
* 客户端和服务端基于状态通信，状态详细说明后续会有图。
* 容错重连，是为每位用户分配id的方式(类似qq号，注意不是fd)和使用SIGPIPE信号处理函数实现的。
* 缺陷，在服务端和客户端未实现持久化，即退出后数据清空。

## 编译过程
使用c++14标准在linux上编译。
make

## 可执行程序
包括server和client两部分。
* 首先将IP和端口号写入配置文件server.config和client.config
* ./server 启动server， ./client 启动client

## client使用说明
* ./client 启动后会有创建或选择聊天室提示。
* 输入 "0-[nickname]"，表示创建聊天室， 输入"[id]-[nickname]"会进入指定id的聊天室。
* 进入聊天室后，便可以收发消息，其中有一些特殊的命令：

"LOG_OUT", 程序退出。
"EXIT_ROOM", 退出房间，注意群主（创建者）退出会解散房间。
"OPEN", 开门，阻止其他人进入 只有群主有权
"CLOSE", 关门， 允许其他人进入 只有群主有权
"RENAME"， 重新改昵称

* 其他命令
"RETRY"， 断网或服务器崩溃等时，重新尝试连接，仅仅是时间很短的断网不能使TCP连接断开，则网络恢复后，无需输入，自动连接。这里的情况，特指客户端产生SIGPIPE异常信号时恢复重连。若服务器资源耗尽，或者房间由于群主退出失效，输入"RETRY"进入重选ID的步骤。

"LIST"， 会请求聊天室已有的房间id。

* 程序命令
"SIGNAL" 为程序占用，用户不能输入。

## 感谢

感谢 Sixzeroo 提供的聊天室思路。
